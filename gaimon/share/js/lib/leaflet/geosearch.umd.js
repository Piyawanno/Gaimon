!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("leaflet")):"function"==typeof define&&define.amd?define(["exports","leaflet"],n):n((t=t||self).GeoSearch={},t.L)}(this,function(t,n){function r(){return(r=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(t[e]=r[e])}return t}).apply(this,arguments)}function e(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n}function i(t,n){return(i=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function s(t,n,r){return(s=o()?Reflect.construct:function(t,n,r){var e=[null];e.push.apply(e,n);var o=new(Function.bind.apply(t,e));return r&&i(o,r.prototype),o}).apply(null,arguments)}function u(t,n,r,e){void 0===n&&(n=""),void 0===e&&(e={});var i=document.createElement(t);return n&&(i.className=n),Object.keys(e).forEach(function(t){if("function"==typeof e[t]){var n=0===t.indexOf("on")?t.substr(2).toLowerCase():t;i.addEventListener(n,e[t])}else"html"===t?i.innerHTML=e[t]:"text"===t?i.innerText=e[t]:i.setAttribute(t,e[t])}),r&&r.appendChild(i),i}function a(t){t.preventDefault(),t.stopPropagation()}n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n;var c=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.filter(Boolean).join(" ").trim()};function h(t,n){t&&t.classList&&(Array.isArray(n)?n:[n]).forEach(function(n){t.classList.contains(n)||t.classList.add(n)})}function f(t,n){t&&t.classList&&(Array.isArray(n)?n:[n]).forEach(function(n){t.classList.contains(n)&&t.classList.remove(n)})}var l,v=13,d=40,p=38,m=[v,27,d,p,37,39],y=function(){function t(t){var n=this,r=t.handleSubmit,e=t.searchLabel,i=t.classNames,o=void 0===i?{}:i;this.hasError=!1,this.container=u("div",c("geosearch",o.container)),this.form=u("form",["",o.form].join(" "),this.container,{autocomplete:"none",onClick:a,onDblClick:a,touchStart:a,touchEnd:a}),this.input=u("input",["glass",o.input].join(" "),this.form,{type:"text",placeholder:e||"search",onInput:this.onInput,onKeyUp:function(t){return n.onKeyUp(t)},onKeyPress:function(t){return n.onKeyPress(t)},onFocus:this.onFocus,onBlur:this.onBlur,onClick:function(){n.input.focus(),n.input.dispatchEvent(new Event("focus"))}}),this.handleSubmit=r}var n=t.prototype;return n.onFocus=function(){h(this.form,"active")},n.onBlur=function(){f(this.form,"active")},n.onSubmit=function(t){try{var n=this;return a(t),f(r=n.container,"error"),h(r,"pending"),Promise.resolve(n.handleSubmit({query:n.input.value})).then(function(){f(n.container,"pending")})}catch(t){return Promise.reject(t)}var r},n.onInput=function(){this.hasError&&(f(this.container,"error"),this.hasError=!1)},n.onKeyUp=function(t){27===t.keyCode&&(f(this.container,["pending","active"]),this.input.value="",document.body.focus(),document.body.blur())},n.onKeyPress=function(t){t.keyCode===v&&this.onSubmit(t)},n.setQuery=function(t){this.input.value=t},t}(),b=function(){function t(t){var n=this,r=t.handleClick,e=t.classNames,i=void 0===e?{}:e;this.selected=-1,this.results=[],this.onClick=function(t){if("function"==typeof n.handleClick){var r=t.target;if(r&&n.container.contains(r)&&r.hasAttribute("data-key")){var e=Number(r.getAttribute("data-key"));n.handleClick({result:n.results[e]})}}},this.handleClick=r,this.container=u("div",c("results",i.container)),this.container.addEventListener("click",this.onClick,!0),this.resultItem=u("div",c(i.item))}var n=t.prototype;return n.render=function(t){var n=this;void 0===t&&(t=[]),this.clear(),t.forEach(function(t,r){var e=n.resultItem.cloneNode(!0);e.setAttribute("data-key",""+r),e.innerHTML=t.label,n.container.appendChild(e)}),t.length>0&&(h(this.container.parentElement,"open"),h(this.container,"active")),this.results=t},n.select=function(t){return Array.from(this.container.children).forEach(function(n,r){return r===t?h(n,"active"):f(n,"active")}),this.selected=t,this.results[t]},n.count=function(){return this.results?this.results.length:0},n.clear=function(){for(this.selected=-1;this.container.lastChild;)this.container.removeChild(this.container.lastChild);f(this.container.parentElement,"open"),f(this.container,"active")},t}(),g={position:"topleft",style:"button",showMarker:!0,showPopup:!1,popupFormat:function(t){return""+t.result.label},marker:{icon:n&&n.Icon?new n.Icon.Default:void 0,draggable:!1},maxMarkers:1,maxSuggestions:5,retainZoomLevel:!1,animateZoom:!0,searchLabel:"Enter address",notFoundMessage:"Sorry, that address could not be found.",messageHideDelay:3e3,zoomLevel:18,classNames:{container:"leaflet-bar leaflet-control leaflet-control-geosearch",button:"leaflet-bar-part leaflet-bar-part-single",resetButton:"reset",msgbox:"leaflet-bar message",form:"",input:""},autoComplete:!0,autoCompleteDelay:250,autoClose:!1,keepResult:!1},w={},k=["dragging","touchZoom","doubleClickZoom","scrollWheelZoom","boxZoom","keyboard"],P="Leaflet must be loaded before instantiating the GeoSearch control",x={options:r({},g),classNames:r({},g.classNames),initialize:function(t){var e,i,o,s,c=this;if(!n)throw new Error(P);if(!t.provider)throw new Error("Provider is missing from options");this.options=r({},this.options,{},t),this.classNames=r({},this.classNames,{},t.classNames),this.markers=new n.FeatureGroup,this.classNames.container+=" leaflet-geosearch-"+this.options.style,this.searchElement=new y({searchLabel:this.options.searchLabel,classNames:{container:this.classNames.container,form:this.classNames.form,input:this.classNames.input},handleSubmit:function(t){return c.onSubmit(t)}}),this.button=u("a",this.classNames.button,this.searchElement.container,{title:this.options.searchLabel,href:"#",onClick:function(t){return c.onClick(t)},onDblClick:function(t){return a(t)}}),this.resetButton=u("a",this.classNames.resetButton,this.searchElement.form,{text:"Ã—",href:"#",onClick:function(){return c.clearResults(null,!0)}}),this.options.autoComplete&&(this.resultList=new b({handleClick:function(t){var n=t.result;c.searchElement.input.value=n.label,c.onSubmit({query:n.label,data:n})}}),this.searchElement.form.appendChild(this.resultList.container),this.searchElement.input.addEventListener("keyup",(e=function(t){return c.autoSearch(t)},void 0===(i=this.options.autoCompleteDelay)&&(i=250),void 0===o&&(o=!1),function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];s&&clearTimeout(s),s=setTimeout(function(){s=null,o||e.apply(void 0,n)},i),o&&!s&&e.apply(void 0,n)}),!0),this.searchElement.input.addEventListener("keydown",function(t){return c.selectResult(t)},!0),this.searchElement.input.addEventListener("keydown",function(t){return c.clearResults(t,!0)},!0)),this.searchElement.form.addEventListener("mouseenter",function(t){c.disableHandlers(t)},!0),this.searchElement.form.addEventListener("mouseleave",function(){return c.restoreHandlers()},!0),this.searchElement.form.addEventListener("click",function(t){t.preventDefault()},!1)},onAdd:function(t){var n=this.options,r=n.showMarker,e=n.style;if(this.map=t,r&&this.markers.addTo(t),"bar"===e){var i=t.getContainer().querySelector(".leaflet-control-container");this.container=u("div","leaflet-control-geosearch leaflet-geosearch-bar"),this.container.appendChild(this.searchElement.form),i.appendChild(this.container)}return this.searchElement.container},onRemove:function(){var t;return null==(t=this.container)||t.remove(),this},onClick:function(t){t.preventDefault();var n=this.searchElement,r=n.container,e=n.input;r.classList.contains("active")?(f(r,"active"),this.clearResults()):(h(r,"active"),e.focus())},disableHandlers:function(t){var n=this;this.searchElement.form.contains(t.target)&&k.forEach(function(t){var r,e;w[t]=null==(r=n.map[t])?void 0:r.enabled(),null==(e=n.map[t])||e.disable()})},restoreHandlers:function(t){var n=this;t&&!this.searchElement.form.includes(t.target)||k.forEach(function(t){var r;w[t]&&(null==(r=n.map[t])||r.enable())})},selectResult:function(t){if(-1!==[v,d,p].indexOf(t.keyCode))if(t.preventDefault(),t.keyCode!==v){var n=this.resultList.count()-1;if(!(n<0)){var r=this.resultList.selected,e=t.keyCode===d?r+1:r-1,i=this.resultList.select(e<0?n:e>n?0:e);this.searchElement.input.value=i.label}}else{var o=this.resultList.select(this.resultList.selected);this.onSubmit({query:this.searchElement.input.value,data:o})}},clearResults:function(t,n){if(void 0===n&&(n=!1),!t||27===t.keyCode){var r=this.options,e=r.autoComplete;!n&&r.keepResult||(this.searchElement.input.value="",this.markers.clearLayers()),e&&this.resultList.clear()}},autoSearch:function(t){try{var n=this;if(m.indexOf(t.keyCode)>-1)return Promise.resolve();var r=t.target.value,e=n.options.provider,i=function(){if(r.length)return Promise.resolve(e.search({query:r})).then(function(t){t=t.slice(0,n.options.maxSuggestions),n.resultList.render(t)});n.resultList.clear()}();return Promise.resolve(i&&i.then?i.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},onSubmit:function(t){try{var n=this;return Promise.resolve(n.options.provider.search(t)).then(function(r){r&&r.length>0&&n.showResult(r[0],t)})}catch(t){return Promise.reject(t)}},showResult:function(t,n){var r=this.options.autoClose,e=Object.keys(this.markers.t);e.length>=this.options.maxMarkers&&this.markers.removeLayer(e[0]);var i=this.addMarker(t,n);this.centerMap(t),this.map.fireEvent("geosearch/showlocation",{location:t,marker:i}),r&&this.closeResults()},closeResults:function(){var t=this.searchElement.container;t.classList.contains("active")&&f(t,"active"),this.restoreHandlers(),this.clearResults()},addMarker:function(t,r){var e=this,i=this.options,o=i.marker,s=i.showPopup,u=i.popupFormat,a=new n.Marker([t.y,t.x],o),c=t.label;return"function"==typeof u&&(c=u({query:r,result:t})),a.bindPopup(c),this.markers.addLayer(a),s&&a.openPopup(),o.draggable&&a.on("dragend",function(t){e.map.fireEvent("geosearch/marker/dragend",{location:a.getLatLng(),event:t})}),a},centerMap:function(t){var r=this.options,e=r.retainZoomLevel,i=r.animateZoom,o=t.bounds?new n.LatLngBounds(t.bounds):new n.LatLng(t.y,t.x).toBounds(10),s=o.isValid()?o:this.markers.getBounds();!e&&o.isValid()?this.map.fitBounds(s,{animate:i}):this.map.setView(s.getCenter(),this.getZoom(),{animate:i})},getZoom:function(){var t=this.options,n=t.zoomLevel;return t.retainZoomLevel?this.map.getZoom():n}};function R(){if(!n)throw new Error(P);for(var t=n.Control.extend(x),r=arguments.length,e=new Array(r),i=0;i<r;i++)e[i]=arguments[i];return s(t,e)}!function(t){t[t.SEARCH=0]="SEARCH",t[t.REVERSE=1]="REVERSE"}(l||(l={}));var j=function(){function t(t){void 0===t&&(t={}),this.options=t}var n=t.prototype;return n.getParamString=function(t){void 0===t&&(t={});var n=r({},this.options.params,{},t);return Object.keys(n).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(n[t])}).join("&")},n.getUrl=function(t,n){return t+"?"+this.getParamString(n)},n.search=function(t){try{var n=this,r=n.endpoint({query:t.query,type:l.SEARCH});return Promise.resolve(fetch(r)).then(function(t){return Promise.resolve(t.json()).then(function(t){return n.parse({data:t})})})}catch(t){return Promise.reject(t)}},t}(),q=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var i=n.prototype;return i.endpoint=function(){return"https://places-dsn.algolia.net/1/places/query"},i.getLabel=function(t){var n,r,e,i,o;return[null==(n=t.locale_names)?void 0:n.default,null==(r=t.city)?void 0:r.default,null==(e=t.administrative)?void 0:e[0],null==(i=t.postcode)?void 0:i[0],null==(o=t.country)?void 0:o.default].filter(Boolean).join(", ")},i.parse=function(t){var n=this;return t.data.hits.map(function(t){return{x:t.i.lng,y:t.i.lat,label:n.getLabel(t),bounds:null,raw:t}})},i.search=function(t){var n=t.query;try{var e=this,i="string"==typeof n?{query:n}:n;return Promise.resolve(fetch(e.endpoint(),{method:"POST",body:JSON.stringify(r({},e.options.params,{},i))})).then(function(t){return Promise.resolve(t.json()).then(function(t){return e.parse({data:t})})})}catch(t){return Promise.reject(t)}},n}(j),C=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).searchUrl="https://dev.virtualearth.net/REST/v1/Locations",n}e(n,t);var r=n.prototype;return r.endpoint=function(t){var n=t.query,r="string"==typeof n?{q:n}:n;return r.jsonp=t.jsonp,this.getUrl(this.searchUrl,r)},r.parse=function(t){return 0===t.data.resourceSets.length?[]:t.data.resourceSets[0].resources.map(function(t){return{x:t.point.coordinates[1],y:t.point.coordinates[0],label:t.address.formattedAddress,bounds:[[t.bbox[0],t.bbox[1]],[t.bbox[2],t.bbox[3]]],raw:t}})},r.search=function(t){var n,r,e,i=t.query;try{var o=this,s="BING_JSONP_CB_"+Date.now();return Promise.resolve((n=o.endpoint({query:i,jsonp:s}),r=s,e=u("script",null,document.body),e.setAttribute("type","text/javascript"),new Promise(function(t){window[r]=function(n){e.remove(),delete window[r],t(n)},e.setAttribute("src",n)}))).then(function(t){return o.parse({data:t})})}catch(t){return Promise.reject(t)}},n}(j),S=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).searchUrl="https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/find",n}e(n,t);var r=n.prototype;return r.endpoint=function(t){var n=t.query,r="string"==typeof n?{text:n}:n;return r.f="json",this.getUrl(this.searchUrl,r)},r.parse=function(t){return t.data.locations.map(function(t){return{x:t.feature.geometry.x,y:t.feature.geometry.y,label:t.name,bounds:[[t.extent.ymin,t.extent.xmin],[t.extent.ymax,t.extent.xmax]],raw:t}})},n}(j),E=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).searchUrl="https://maps.googleapis.com/maps/api/geocode/json",n}e(n,t);var r=n.prototype;return r.endpoint=function(t){var n=t.query;return this.getUrl(this.searchUrl,"string"==typeof n?{address:n}:n)},r.parse=function(t){return t.data.results.map(function(t){return{x:t.geometry.location.lng,y:t.geometry.location.lat,label:t.formatted_address,bounds:[[t.geometry.viewport.southwest.lat,t.geometry.viewport.southwest.lng],[t.geometry.viewport.northeast.lat,t.geometry.viewport.northeast.lng]],raw:t}})},n}(j),O=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).searchUrl="https://geocode.search.hereapi.com/v1/geocode",n}e(n,t);var r=n.prototype;return r.endpoint=function(t){var n=t.query;return this.getUrl(this.searchUrl,"string"==typeof n?{q:n}:n)},r.parse=function(t){return t.data.items.map(function(t){return{x:t.position.lng,y:t.position.lat,label:t.address.label,bounds:null,raw:t}})},n}(j),A=function(t){function n(n){var r;void 0===n&&(n={});var e="https://nominatim.openstreetmap.org";return(r=t.call(this,n)||this).searchUrl=n.searchUrl||e+"/search",r.reverseUrl=n.reverseUrl||e+"/reverse",r}e(n,t);var r=n.prototype;return r.endpoint=function(t){var n=t.query,r=t.type,e="string"==typeof n?{q:n}:n;switch(e.format="json",r){case l.REVERSE:return this.getUrl(this.reverseUrl,e);default:return this.getUrl(this.searchUrl,e)}},r.parse=function(t){return(Array.isArray(t.data)?t.data:[t.data]).map(function(t){return{x:Number(t.lon),y:Number(t.lat),label:t.display_name,bounds:[[parseFloat(t.boundingbox[0]),parseFloat(t.boundingbox[2])],[parseFloat(t.boundingbox[1]),parseFloat(t.boundingbox[3])]],raw:t}})},n}(j),N=function(t){function n(n){return t.call(this,r({},n,{searchUrl:"https://locationiq.org/v1/search.php",reverseUrl:"https://locationiq.org/v1/reverse.php"}))||this}return e(n,t),n}(A),F=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).searchUrl="https://api.opencagedata.com/geocode/v1/json",n}e(n,t);var r=n.prototype;return r.endpoint=function(t){var n=t.query,r="string"==typeof n?{q:n}:n;return r.format="json",this.getUrl(this.searchUrl,r)},r.parse=function(t){return t.data.results.map(function(t){return{x:t.geometry.lng,y:t.geometry.lat,label:t.formatted,bounds:[[t.bounds.southwest.lat,t.bounds.southwest.lng],[t.bounds.northeast.lat,t.bounds.northeast.lng]],raw:t}})},r.search=function(n){try{return Promise.resolve(n.query.length<2?[]:t.prototype.search.call(this,n))}catch(t){return Promise.reject(t)}},n}(j);t.AlgoliaProvider=q,t.BingProvider=C,t.EsriProvider=S,t.GeoSearchControl=R,t.GoogleProvider=E,t.HereProvider=O,t.JsonProvider=j,t.LocationIQProvider=N,t.OpenCageProvider=F,t.OpenStreetMapProvider=A,t.SearchControl=R,t.SearchElement=y});
//# sourceMappingURL=geosearch.umd.js.map
